name: Keep Streamlit App Alive

on:
  schedule:
    - cron: '*/15 * * * *'  # Automatic: Every 15 minutes
  workflow_dispatch:        # Manual: Trigger via GitHub UI

jobs:
  wake-up:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Playwright and dependencies
        run: |
          python -m pip install playwright
          playwright install chromium
          playwright install-deps chromium

      - name: Run wake-up script
        run: |
          python - <<EOF
          from playwright.sync_api import sync_playwright

          with sync_playwright() as p:
              browser = p.chromium.launch()
              page = browser.new_page()
              page.goto("https://makans.streamlit.app/")
              
              if "This app has gone to sleep" in page.content():
                  page.click("text='Yes, get this app back up?'")
                  print("App woke up successfully!")
              else:
                  print("App is already awake.")
              
              browser.close()
          EOF
